{% extends 'Films/base.html' %}
{% load static %}

{% block title %}Accueil CinÃ©ma{% endblock %}

{% block content %}

<h2>ğŸ¬ Films disponibles</h2>

<!-- ğŸ” Filtre par genre -->
<form method="get" class="genre-filter">
    <select name="genre" onchange="this.form.submit()">
        <option value="">Tous les genres</option>
        <option value="Action"> {% if genre == 'Action' %}selected{% endif %}>Action</option>
        <option value="Drame"> {% if genre == 'Drame' %}selected{% endif %}>Drame</option>
        <option value="ComÃ©die"> {% if genre == 'ComÃ©die' %}selected{% endif %}>ComÃ©die</option>
        <option value="Horreur"> {% if genre == 'Horreur' %}selected{% endif %}>Horreur</option>
        <option value="Science-Fiction"> {% if genre == 'Science-Fiction' %}selected{% endif %}>Science-Fiction</option>
        <option value="Autre"> {% if genre == 'Autre' %}selected{% endif %}Autre</option>
    </select>
</form>


<!-- ğŸï¸ Liste des films -->
<div class="films-grid">
    {% for film in films %}
        <div class="film-card">
            {% if film.affiche %}
                <img src="{{ film.affiche.url }}" alt="{{ film.titre }}">
            {% else %}
                <img src="{% static 'film/default.png' %}" alt="Pas d'affiche">
            {% endif %}

            <h3>{{ film.titre }}</h3>
            <p>{{ film.genre }} | {{ film.duree_h_min }}</p>

            <a href="{% url 'film_detail' film.id %}" class="btn">
                ğŸ¥ Voir dÃ©tails
            </a>
        </div>
    {% empty %}
        <p>Aucun film disponible pour ce genre.</p>
    {% endfor %}
</div>

<!-- ğŸŸï¸ RÃ©servations de l'utilisateur -->
{% if user.is_authenticated %}
    <h2>ğŸŸï¸ Mes rÃ©servations</h2>
    {% if reservations %}
        <ul class="reservations">
            {% for r in reservations %}
                <li>
                    ğŸ¬ {{ r.seance.film.titre }} â€”
                    ğŸ›ï¸ {{ r.seance.salle.nom }} â€”
                    ğŸª‘ SiÃ¨ge {{ r.siege }} â€”
                    ğŸ“… {{ r.seance.date }} â° {{ r.seance.heure }} â€”
                    RÃ©servÃ© le {{ r.date_reservation|date:"d/m/Y H:i" }}
                    <form method="post" action="{% url 'annuler_reservation' r.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit">âŒ Annuler</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Vous nâ€™avez pas encore de rÃ©servation.</p>
    {% endif %}
{% endif %}

{% endblock %}
